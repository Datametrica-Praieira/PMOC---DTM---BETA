<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <base target="_top">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PMOC - DTM | Smart Maintenance</title>
    <!-- Font -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Icons -->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <!-- QR Scanner -->
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>

    <style>
        :root {
            --primary: #BE1E2D;
            /* Datametrica Red */
            --primary-dark: #A31825;
            /* Darker Red */
            --primary-light: rgba(190, 30, 45, 0.2);
            /* Soft Red for Glow */
            --bg-color: #121212;
            /* Deep Space / Carbon Grey */
            --card-bg: rgba(30, 30, 30, 0.6);
            /* Dark Glass effect */
            --card-border: rgba(255, 255, 255, 0.08);
            /* Suave grey border */
            --text-main: #f8fafc;
            --text-muted: #a0a0a0;
            --success: #10b981;
            --danger: #ef4444;
            --sidebar-width: 250px;
            --radius-md: 16px;
            --radius-sm: 10px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Outfit', sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            line-height: 1.6;
            background-image: radial-gradient(circle at 15% 50%, var(--primary-light), transparent 25%),
                radial-gradient(circle at 85% 30%, rgba(190, 30, 45, 0.1), transparent 25%);
            background-attachment: fixed;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* ----- GLASSMORPHISM UTILS ----- */
        .glass {
            background: var(--card-bg);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid var(--card-border);
            border-radius: var(--radius-md);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }

        /* ----- LOGIN SCREEN ----- */
        #login-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            width: 100vw;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1000;
            background-color: var(--bg-color);
            transition: opacity 0.5s ease;
        }

        .login-box {
            width: 90%;
            max-width: 400px;
            padding: 40px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            animation: slideUp 0.6s ease;
        }

        .login-box h1 {
            font-size: 32px;
            font-weight: 700;
            color: var(--primary);
            text-align: center;
            margin-bottom: 20px;
        }

        .login-box p {
            text-align: center;
            color: var(--text-muted);
            margin-bottom: 20px;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ----- MAIN APP WRAPPER ----- */
        #app {
            display: none;
            /* Hide out of the gate */
            min-height: 100vh;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        #app.visible {
            display: flex;
            opacity: 1;
        }

        /* ----- SIDEBAR ----- */
        .sidebar {
            width: var(--sidebar-width);
            background: rgba(11, 15, 25, 0.4);
            backdrop-filter: blur(20px);
            border-right: 1px solid var(--card-border);
            padding: 30px 20px;
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            z-index: 100;
            transition: transform 0.3s;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 26px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 50px;
        }

        .nav-links {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .nav-links li {
            padding: 14px 18px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 15px;
            color: var(--text-muted);
            font-weight: 500;
            transition: all 0.3s;
        }

        .nav-links li:hover {
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
            transform: translateX(5px);
        }

        .nav-links li.active {
            background: rgba(0, 240, 255, 0.1);
            color: var(--primary);
            border: 1px solid rgba(0, 240, 255, 0.3);
            box-shadow: 0 0 15px rgba(0, 240, 255, 0.1);
        }

        /* Logout Button */
        .logout-btn {
            margin-top: auto;
            color: var(--danger) !important;
            font-weight: 600;
        }

        .logout-btn:hover {
            background: rgba(239, 68, 68, 0.1) !important;
            color: #fca5a5 !important;
        }

        /* ----- CONTENT AREA ----- */
        .content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 40px;
            width: calc(100% - var(--sidebar-width));
            position: relative;
        }

        .topbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
        }

        .user-greeting h1 {
            font-size: 28px;
            font-weight: 600;
        }

        .user-greeting p {
            color: var(--primary);
            font-size: 14px;
            margin-top: 4px;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .user-profile img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid var(--primary);
            padding: 2px;
        }

        /* ----- VIEWS & ANIMATIONS ----- */
        .view {
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .view.active {
            display: block;
            opacity: 1;
            animation: contentFade 0.4s ease forwards;
        }

        @keyframes contentFade {
            from {
                opacity: 0;
                transform: translateY(15px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ----- CARDS (OVERRIDE) ----- */
        .card {
            padding: 30px;
        }

        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 20px;
        }

        .stat-card {
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(0, 240, 255, 0.1) 0%, transparent 60%);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: rgba(0, 240, 255, 0.4);
            box-shadow: 0 10px 30px rgba(0, 240, 255, 0.15);
        }

        .stat-card:hover::before {
            opacity: 1;
        }

        .stat-card .icon-wrapper {
            width: 70px;
            height: 70px;
            background: rgba(0, 240, 255, 0.1);
            color: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            margin: 0 auto 20px;
            border: 1px solid rgba(0, 240, 255, 0.3);
        }

        .stat-card h3 {
            font-size: 18px;
            color: var(--text-main);
            margin-bottom: 8px;
            font-weight: 600;
        }

        .stat-card p {
            font-size: 14px;
            color: var(--text-muted);
        }

        /* ----- FORMS & INPUTS ----- */
        .form-group-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }

        .form-field {
            margin-bottom: 20px;
        }

        .form-field label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-muted);
            font-size: 14px;
        }

        input[type="text"],
        input[type="password"],
        input[type="date"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 14px 16px;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid var(--card-border);
            border-radius: var(--radius-sm);
            color: #fff;
            font-size: 15px;
            outline: none;
            transition: all 0.3s;
        }

        input:focus,
        select:focus,
        textarea:focus {
            border-color: var(--primary);
            box-shadow: 0 0 10px rgba(0, 240, 255, 0.2);
            background: rgba(0, 0, 0, 0.4);
        }

        select option {
            background: var(--bg-color);
            color: #fff;
        }

        .checklist-section {
            background: rgba(0, 0, 0, 0.15);
            padding: 25px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--card-border);
            margin-bottom: 25px;
        }

        .checklist-section h3 {
            margin-bottom: 15px;
            font-size: 16px;
            color: var(--primary);
            font-weight: 500;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
            cursor: pointer;
            color: var(--text-muted);
            transition: color 0.2s;
        }

        .checkbox-label:hover {
            color: #fff;
        }

        .checkbox-label input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: var(--primary);
            cursor: pointer;
        }

        /* ----- NOTIFICATION TOAST ----- */
        #toast-container {
            position: fixed;
            top: 25px;
            right: 25px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 12px;
            pointer-events: none;
        }

        .toast {
            background: rgba(30, 30, 30, 0.9);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #fff;
            padding: 14px 24px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
            transform: translateX(120%);
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            min-width: 250px;
            pointer-events: auto;
        }

        .toast.visible {
            transform: translateX(0);
        }

        .toast.success {
            border-left: 4px solid #10b981;
        }

        .toast.error {
            border-left: 4px solid #ef4444;
        }

        .toast.info {
            border-left: 4px solid var(--primary);
        }

        .toast i {
            font-size: 20px;
        }

        /* ----- BUTTONS ----- */
        .btn {
            padding: 12px 24px;
            border-radius: var(--radius-sm);
            font-weight: 600;
            cursor: pointer;
            border: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s;
            font-size: 15px;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: #fff;
            box-shadow: 0 4px 15px rgba(190, 30, 45, 0.3);
            text-transform: uppercase;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(190, 30, 45, 0.5);
            filter: brightness(1.1);
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--card-border);
            color: var(--text-main);
        }

        .btn-outline:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .form-actions {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            justify-content: flex-end;
        }

        /* ----- TABLES & LISTS ----- */
        .machine-info-grid {
            display: grid;
            grid-template-columns: 1.5fr 1fr;
            gap: 25px;
        }

        @media (max-width: 992px) {
            .machine-info-grid {
                grid-template-columns: 1fr;
            }
        }

        #machine-details-list {
            list-style: none;
            margin-top: 20px;
        }

        #machine-details-list li {
            padding: 14px 0;
            border-bottom: 1px solid var(--card-border);
            display: flex;
            justify-content: space-between;
            font-size: 15px;
        }

        #machine-details-list li strong {
            color: var(--primary);
        }

        .data-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }

        .data-table th,
        .data-table td {
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid var(--card-border);
        }

        .data-table th {
            color: var(--text-muted);
            font-weight: 500;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .data-table tr {
            transition: background 0.2s;
        }

        .data-table tr:hover {
            background: rgba(255, 255, 255, 0.02);
        }

        .badge {
            background: rgba(190, 30, 45, 0.15);
            color: var(--primary);
            border: 1px solid rgba(190, 30, 45, 0.3);
            padding: 5px 14px;
            border-radius: 100px;
            font-size: 12px;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        /* ----- LOADERS & HELPERS ----- */
        .mt-20 {
            margin-top: 20px;
        }

        .loader {
            border: 3px solid rgba(190, 30, 45, 0.1);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s cubic-bezier(0.55, 0.15, 0.45, 0.85) infinite;
            display: none;
            margin: 30px auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* ----- PRINT (A4) OFICIAL PMOC ----- */
        .print-only {
            display: none;
        }

        @media print {
            @page {
                margin: 1cm;
                size: A4 portrait;
            }

            body {
                background: white !important;
                font-size: 11pt !important;
            }

            body * {
                visibility: hidden;
            }

            #printable-area,
            #printable-area * {
                visibility: visible;
                color: black !important;
                font-family: 'Times New Roman', Times, serif !important;
            }

            #printable-area {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                display: block;
            }

            .pmoc-print-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                border-bottom: 2px solid black;
                padding-bottom: 10px;
                margin-bottom: 15px;
            }

            .pmoc-print-header h1 {
                font-size: 16pt;
                font-weight: bold;
                margin-bottom: 5px;
                text-transform: uppercase;
            }

            .pmoc-print-header p {
                font-size: 10pt;
                margin: 2px 0;
            }

            .pmoc-print-section {
                margin-bottom: 15px;
            }

            .pmoc-print-section h3 {
                background: #f0f0f0;
                border: 1px solid black;
                padding: 4px;
                font-size: 12pt;
                text-transform: uppercase;
                margin-bottom: 8px;
            }

            .pmoc-table {
                width: 100%;
                border-collapse: collapse;
                margin-bottom: 10px;
                font-size: 10pt;
            }

            .pmoc-table th,
            .pmoc-table td {
                border: 1px solid black;
                padding: 6px;
                text-align: left;
            }

            .pmoc-table th {
                background-color: #f9f9f9;
                width: 30%;
            }

            .pmoc-text-block {
                border: 1px solid black;
                padding: 8px;
                font-size: 10pt;
                text-align: justify;
                margin-bottom: 10px;
            }

            .pmoc-signature-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 40px;
                margin-top: 30px;
            }

            .pmoc-sig-box {
                text-align: center;
                font-size: 10pt;
            }

            .pmoc-sig-line {
                border-top: 1px solid black;
                margin: 0 auto 5px auto;
                width: 90%;
            }

            .legal-footer {
                font-size: 8pt;
                text-align: justify;
                margin-top: 15px;
                border-top: 1px dashed #ccc;
                padding-top: 5px;
            }
        }

        /* ----- MOBILE RESPONSIVENESS ----- */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                width: 100%;
                max-width: 280px;
            }

            .sidebar.mobile-open {
                transform: translateX(0);
                box-shadow: 20px 0 50px rgba(0, 0, 0, 0.5);
            }

            .content {
                margin-left: 0;
                width: 100%;
                padding: 20px;
            }

            .machine-info-grid,
            .form-group-grid {
                grid-template-columns: 1fr;
            }

            .mobile-menu-btn {
                display: block !important;
            }
        }

        .mobile-menu-btn {
            display: none;
            font-size: 26px;
            cursor: pointer;
            color: var(--primary);
        }

        /* ----- RESTRICT VIEW ----- */
        .admin-only {
            display: none;
        }

        /* Show via JS if user is Admin */
    </style>
</head>

<body>

    <!-- 1. TELA DE LOGIN -->
    <div id="login-container">
        <div class="glass login-box">
            <div style="text-align: center; margin-bottom: 15px;">
                <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" style="width: 60px; height: 60px;">
                    <path d="M 0 20 Q 0 0 20 0 L 100 0 L 100 80 Q 100 100 80 100 L 0 100 Z" fill="#b0b0b0" />
                    <rect x="50" y="0" width="50" height="50" fill="#BE1E2D" />
                    <rect x="25" y="50" width="25" height="25" fill="#58595b" />
                    <rect x="0" y="75" width="25" height="25" fill="#58595b" />
                </svg>
            </div>
            <h1>PMOC - DTM</h1>
            <p>Acesso Corporativo Seguro</p>
            <div id="loginForm">
                <div class="form-field">
                    <label>Usuário Corporativo</label>
                    <input type="text" id="login-user" required placeholder="Digite seu usuário"
                        onkeydown="if(event.key==='Enter') app.attemptLogin()">
                </div>
                <div class="form-field">
                    <label>Senha de Acesso</label>
                    <input type="password" id="login-pass" required placeholder="••••••••"
                        onkeydown="if(event.key==='Enter') app.attemptLogin()">
                </div>
                <button type="button" class="btn btn-primary" style="width: 100%; margin-top: 10px;" id="login-btn">
                    Conectar <i class="ri-arrow-right-line"></i>
                </button>
            </div>
            <div id="login-loader" class="loader" style="width: 25px; height: 25px; margin: 10px auto;"></div>
        </div>
    </div>

    <!-- 2. APLICATIVO PRINCIPAL -->
    <div id="app">
        <nav class="sidebar" id="sidebar">
            <div class="logo" style="display:flex; align-items:center;">
                <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"
                    style="width: 30px; height: 30px; min-width: 30px; margin-right: 10px;">
                    <path d="M 0 20 Q 0 0 20 0 L 100 0 L 100 80 Q 100 100 80 100 L 0 100 Z" fill="#b0b0b0" />
                    <rect x="50" y="0" width="50" height="50" fill="#BE1E2D" />
                    <rect x="25" y="50" width="25" height="25" fill="#58595b" />
                    <rect x="0" y="75" width="25" height="25" fill="#58595b" />
                </svg>
                <span>PMOC - DTM</span>
                <i class="ri-close-line mobile-menu-btn" style="margin-left:auto;" onclick="app.toggleSidebar()"></i>
            </div>
            <ul class="nav-links">
                <li class="active" onclick="app.navigate('home')"><i class="ri-dashboard-3-line"></i> Painel de Controle
                </li>
                <li onclick="app.navigate('scanner')"><i class="ri-qr-scan-line"></i> Escanear Tag (QR)</li>
                <li onclick="app.navigate('search')"><i class="ri-search-eye-line"></i> Buscar Equipamento</li>

                <!-- SÓ ADMIN PODE VER -->
                <li class="admin-only" onclick="app.navigate('add-site')"><i class="ri-building-4-line"></i> Cadastrar
                    Edificação</li>
                <li class="admin-only" onclick="app.navigate('add-machine')"><i class="ri-add-box-line"></i> Cadastrar
                    Máquina</li>

                <li class="logout-btn" onclick="app.logout()"><i class="ri-logout-box-r-line"></i> Encerrar Sessão</li>
            </ul>
        </nav>

        <main class="content">
            <header class="topbar">
                <div style="display: flex; gap: 20px; align-items: center;">
                    <i class="ri-menu-4-line mobile-menu-btn" onclick="app.toggleSidebar()"></i>
                    <div class="user-greeting">
                        <h2>Olá, <span id="display-name" style="color:var(--primary); font-weight: 400;">Usuário</span>
                        </h2>
                        <p id="display-role">Perfil: Carregando...</p>
                    </div>
                </div>
                <div class="user-profile">
                    <!-- Glass Avatar -->
                    <div
                        style="width: 50px; height: 50px; background: rgba(190, 30, 45, 0.1); border: 1px solid var(--primary); border-radius: 50%; display: flex; align-items:center; justify-content:center;">
                        <i class="ri-user-star-line" style="color:var(--primary); font-size: 24px;"></i>
                    </div>
                </div>
            </header>

            <div id="main-loader" class="loader"></div>

            <!-- Views -->
            <div id="views-container">
                <!-- Home -->
                <div id="view-home" class="view active">
                    <div class="dashboard-cards">
                        <div class="glass stat-card" onclick="app.navigate('scanner')">
                            <div class="icon-wrapper"><i class="ri-qr-scan-line"></i></div>
                            <h3>Leitura Rápida</h3>
                            <p>Escanear QR Code no Local</p>
                        </div>
                        <div class="glass stat-card" onclick="app.navigate('search')">
                            <div class="icon-wrapper"><i class="ri-database-2-line"></i></div>
                            <h3>Base de Dados</h3>
                            <p>Buscar manualmente no Sheets</p>
                        </div>
                        <div class="glass stat-card admin-only" onclick="app.navigate('add-site')">
                            <div class="icon-wrapper"><i class="ri-building-line"></i></div>
                            <h3>Nova Edificação</h3>
                            <p>Registrar Local / Site</p>
                        </div>
                        <div class="glass stat-card admin-only" onclick="app.navigate('add-machine')">
                            <div class="icon-wrapper"><i class="ri-add-circle-line"></i></div>
                            <h3>Novo Cadastro</h3>
                            <p>Registrar Ar Condicionado</p>
                        </div>
                    </div>
                </div>

                <!-- Scanner -->
                <div id="view-scanner" class="view">
                    <div class="glass card" style="max-width: 600px; margin: 0 auto; text-align:center;">
                        <h2><i class="ri-camera-lens-line" style="color:var(--primary);"></i> Escanear QR Code</h2>
                        <div id="reader"
                            style="width: 100%; max-width: 400px; margin: 30px auto; border-radius: var(--radius-sm); border: 2px solid var(--primary); overflow: hidden;">
                        </div>
                        <div class="form-actions" style="justify-content:center;">
                            <button class="btn btn-outline" onclick="app.stopScanner()">Cancelar</button>
                            <button class="btn btn-primary" onclick="app.startScanner()"><i
                                    class="ri-camera-3-line"></i> Ativar Câmera</button>
                        </div>
                    </div>
                </div>

                <!-- Search -->
                <div id="view-search" class="view">
                    <div class="glass card" style="max-width: 700px;">
                        <h2>Pesquisar Equipamento</h2>
                        <p style="color:var(--text-muted); margin-bottom: 20px;">Insira a TAG do equipamento para buscar
                            na base conectada.</p>
                        <div style="display: flex; gap: 15px;">
                            <input type="text" id="search-input" placeholder="Ex: AC-001" style="flex:1;">
                            <button class="btn btn-primary" onclick="app.searchMachine()"><i class="ri-search-line"></i>
                                Localizar</button>
                        </div>
                    </div>
                </div>

                <!-- Add Site (Admin) -->
                <div id="view-add-site" class="view">
                    <div class="glass card">
                        <h2><i class="ri-building-4-line" style="color:var(--primary);"></i> Registrar Nova Edificação
                        </h2>
                        <form id="addSiteForm" onsubmit="event.preventDefault(); app.saveNewSite();" class="mt-20">
                            <div class="form-group-grid">
                                <div class="form-field"><label>ID Unidade (TAG Local)</label><input type="text"
                                        id="new-site-id" placeholder="Ex: MATRIZ-SP" required></div>
                                <div class="form-field"><label>Razão Social / Nome Fantasia</label><input type="text"
                                        id="new-site-name" required></div>
                                <div class="form-field" style="grid-column: span 2;"><label>Endereço Completo (Rua, Nº,
                                        Cidade)</label><input type="text" id="new-site-address" required></div>
                                <div class="form-field"><label>Nome do Responsável pela Edificação</label><input
                                        type="text" id="new-site-resp" required></div>
                                <div class="form-field"><label>Tipo de Edificação (Uso)</label>
                                    <select id="new-site-type">
                                        <option value="Privado">Privado</option>
                                        <option value="Público / Coletivo">Público / Coletivo</option>
                                        <option value="Industrial">Industrial</option>
                                    </select>
                                </div>
                                <div class="form-field"><label>Ocupação Média</label><input type="number"
                                        id="new-site-occupancy" placeholder="Ex: 50 pessoas"></div>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary"><i class="ri-cloud-upload-line"></i>
                                    Validar e Salvar Site</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Add Machine (Admin) -->
                <div id="view-add-machine" class="view">
                    <div class="glass card">
                        <h2><i class="ri-add-box-line" style="color:var(--primary);"></i> Registrar Novo Equipamento
                        </h2>
                        <form id="addMachineForm" onsubmit="event.preventDefault(); app.saveNewMachine();"
                            class="mt-20">
                            <div class="form-group-grid">
                                <div class="form-field" style="grid-column: span 2;">
                                    <label>Vincular à Edificação</label>
                                    <select id="new-mach-site" required>
                                        <option value="">Selecione um local...</option>
                                    </select>
                                </div>
                                <div class="form-field"><label>TAG Máquina (ID Único)</label><input type="text"
                                        id="new-mach-id" placeholder="Ex: AC-001" required></div>
                                <div class="form-field"><label>Número de Série</label><input type="text"
                                        id="new-mach-serial" placeholder="S/N de fábrica"></div>
                                <div class="form-field"><label>Localização (Setor/Sala/Andar)</label><input type="text"
                                        id="new-mach-loc" required></div>
                                <div class="form-field"><label>Tipo do Sistema</label>
                                    <select id="new-mach-type" required>
                                        <option value="Split Hi-Wall">Split Hi-Wall</option>
                                        <option value="Cassete">Cassete</option>
                                        <option value="Piso Teto">Piso Teto</option>
                                        <option value="VRF / VRV">VRF / VRV</option>
                                        <option value="Central (Dutado)">Central (Dutado)</option>
                                        <option value="Self Contained">Self Contained</option>
                                    </select>
                                </div>
                                <div class="form-field"><label>Capacidade (BTUs)</label><input type="number"
                                        id="new-mach-btu" required></div>
                                <div class="form-field"><label>Fabricante / Marca</label><input type="text"
                                        id="new-mach-brand" required></div>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary"><i class="ri-save-3-line"></i> Concluir
                                    Cadastro Técnico</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Machine Details -->
                <div id="view-machine" class="view">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:25px;">
                        <h2 id="machine-title" style="font-size: 28px;">Máquina Localizada</h2>
                        <button class="btn btn-outline" onclick="app.navigate('home')"><i
                                class="ri-arrow-left-s-line"></i> Voltar</button>
                    </div>

                    <div class="machine-info-grid">
                        <div class="glass card">
                            <h3><i class="ri-information-line" style="color:var(--primary);"></i> Especificações
                                Técnicas</h3>
                            <ul id="machine-details-list"></ul>
                        </div>
                        <div class="glass card"
                            style="display: flex; flex-direction: column; justify-content: center; text-align: center;">
                            <h3 style="margin-bottom: 20px;">Ações Rápidas</h3>
                            <button class="btn btn-primary" onclick="app.showNewPmocForm()"
                                style="width: 100%; padding: 15px; margin-bottom: 15px;"><i class="ri-tools-line"></i>
                                INICIAR PMOC</button>
                            <button class="btn btn-outline" onclick="app.generateMachineQR()"
                                style="width: 100%; padding: 15px; border-color: var(--primary); color: var(--primary);"><i
                                    class="ri-qr-code-line"></i> Gerar Etiqueta QR Code</button>
                        </div>
                    </div>

                    <div class="glass card mt-20">
                        <h3><i class="ri-history-line" style="color:var(--primary);"></i> Histórico PMOC (Google Sheets)
                        </h3>
                        <div style="overflow-x:auto; margin-top:20px;">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Data</th>
                                        <th>Técnico Responsável</th>
                                        <th>Status Checks</th>
                                        <th>Documento</th>
                                    </tr>
                                </thead>
                                <tbody id="machine-history-body"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- New PMOC Form -->
                <div id="view-pmoc-form" class="view">
                    <div class="glass card">
                        <div
                            style="display:flex; justify-content:space-between; align-items:center; border-bottom: 1px solid var(--card-border); padding-bottom: 20px; margin-bottom: 20px;">
                            <h2><i class="ri-file-list-3-line" style="color:var(--primary);"></i> Relatório PMOC</h2>
                            <span class="badge" id="form-machine-id">TAG: -</span>
                        </div>

                        <form id="pmocForm" onsubmit="event.preventDefault(); app.savePmocData();">
                            <div class="form-group-grid">
                                <div class="form-field"><label>Data da Manutenção</label><input type="date"
                                        id="pmoc-date" required></div>
                                <div class="form-field"><label>Técnico Assinante</label><input type="text"
                                        id="pmoc-tecnico" readonly
                                        style="color:var(--primary); border-color:var(--primary);"></div>
                                <div class="form-field"><label>CREA do Técnico (Opcional)</label><input type="text"
                                        id="pmoc-crea" placeholder="Ex: 12345/SP"></div>
                                <div class="form-field"><label>Número da ART (Opcional)</label><input type="text"
                                        id="pmoc-art" placeholder="Ex: BR123000"></div>
                            </div>

                            <div class="checklist-section">
                                <h3>Rotina de Verificação Normativa</h3>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:15px;">
                                    <label class="checkbox-label"><input type="checkbox" id="chk-limpeza"> Limpeza de
                                        filtros/Bandeja</label>
                                    <label class="checkbox-label"><input type="checkbox" id="chk-serpentina"> Inspeção
                                        de serpentina</label>
                                    <label class="checkbox-label"><input type="checkbox" id="chk-pressao"> Medição de
                                        temperatura/pressão</label>
                                    <label class="checkbox-label"><input type="checkbox" id="chk-eletrica"> Reaperto de
                                        contatos elétricos</label>
                                </div>
                            </div>

                            <div class="checklist-section">
                                <h3>Qualidade do Ar (RDC 9) - Avaliação Resumida</h3>
                                <div class="form-group-grid" style="margin-top:15px; grid-template-columns: 1fr;">
                                    <div class="form-field">
                                        <label>Resultado Visível e Odor</label>
                                        <select id="pmoc-ar-status">
                                            <option value="Adequado dentro dos padrões (RDC 09)">Adequado dentro dos
                                                padrões (RDC 09)</option>
                                            <option value="Necessita Limpeza Profunda / Higienização Dutos">Necessita
                                                Limpeza Profunda / Higienização Dutos</option>
                                            <option value="Odor excessivo / Fungos visíveis">Odor excessivo / Fungos
                                                visíveis</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="form-field">
                                <label>Observações Adicionais (Anomalias, peças trocadas)</label>
                                <textarea id="pmoc-obs" rows="4" placeholder="Detalhes do serviço..."></textarea>
                            </div>

                            <div class="form-actions">
                                <button type="button" class="btn btn-outline"
                                    onclick="app.navigate('machine')">Descartar</button>
                                <button type="submit" class="btn btn-primary"><i class="ri-printer-line"></i> Salvar e
                                    Gerar PDF/A4</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <div id="toast-container"></div>
        </main>
    </div>

    <!-- Printable Area -->
    <div id="printable-area" class="print-only"></div>

    <!-- SCRIPTS -->
    <script>
        // Monitor de Erros Globais
        window.onerror = function (msg, url, line) {
            console.error(msg, line);
            return false;
        };

        class PMOCPremium {
            constructor() {
                this.currentUser = null;
                this.currentMachine = null;
                this.html5QrcodeScanner = null;

                try {
                    const savedSession = localStorage.getItem('pmoc_session');
                    if (savedSession) {
                        this.currentUser = JSON.parse(savedSession);
                        this.finishLogin(this.currentUser);
                    }
                } catch (e) { }
            }

            showToast(msg, type = 'info') {
                const container = document.getElementById('toast-container');
                const toast = document.createElement('div');
                toast.className = `toast glass ${type}`;

                let icon = 'ri-information-line';
                if (type === 'success') icon = 'ri-checkbox-circle-line';
                if (type === 'error') icon = 'ri-error-warning-line';

                toast.innerHTML = `<i class="${icon}"></i> <span>${msg}</span>`;
                container.appendChild(toast);

                setTimeout(() => toast.classList.add('visible'), 100);
                setTimeout(() => {
                    toast.classList.remove('visible');
                    setTimeout(() => toast.remove(), 400);
                }, 4000);
            }

            setLoginLoader(state) {
                const btn = document.getElementById('login-btn');
                const loader = document.getElementById('login-loader');
                if (btn) btn.style.display = state ? 'none' : 'block';
                if (loader) loader.style.display = state ? 'block' : 'none';
            }

            attemptLogin() {
                try {
                    const u = document.getElementById('login-user').value;
                    const p = document.getElementById('login-pass').value;

                    if (!u || !p) {
                        this.showToast("Preencha usuário e senha", "error");
                        return;
                    }

                    this.setLoginLoader(true);
                    google.script.run
                        .withFailureHandler((err) => {
                            this.setLoginLoader(false);
                            this.showToast("Erro: " + err.message, "error");
                        })
                        .withSuccessHandler((response) => {
                            this.setLoginLoader(false);
                            if (response.success) {
                                this.currentUser = response.user;
                                try { localStorage.setItem('pmoc_session', JSON.stringify(this.currentUser)); } catch (e) { }
                                this.finishLogin(this.currentUser);
                                this.showToast(`Bem-vindo, ${response.user.name}`, "success");
                            } else {
                                this.showToast(response.message, "error");
                            }
                        })
                        .authenticateUser(u, p);
                } catch (err) {
                    this.showToast("Falha interna", "error");
                    this.setLoginLoader(false);
                }
            }

            finishLogin(user) {
                document.getElementById('login-container').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('login-container').style.display = 'none';
                    document.getElementById('app').classList.add('visible');
                    document.getElementById('display-name').textContent = user.name;
                    document.getElementById('display-role').textContent = `Perfil: ${user.role.toUpperCase()}`;
                    document.getElementById('pmoc-tecnico').value = user.name;

                    if (user.role.toLowerCase() === 'admin') {
                        document.querySelectorAll('.admin-only').forEach(el => el.style.display = 'flex');
                    } else {
                        document.querySelectorAll('.admin-only').forEach(el => el.style.display = 'none');
                    }

                    this.syncSites();
                    this.syncMachines();
                    this.navigate('home');
                }, 400);
            }

            logout() {
                try { localStorage.removeItem('pmoc_session'); } catch (e) { }
                location.reload();
            }

            setLoader(state) {
                const ml = document.getElementById('main-loader');
                if (ml) ml.style.display = state ? 'block' : 'none';
            }

            toggleSidebar() {
                const s = document.getElementById('sidebar');
                if (s) s.classList.toggle('mobile-open');
            }

            navigate(viewId) {
                document.querySelectorAll('.view').forEach(el => el.classList.remove('active'));
                const target = document.getElementById(`view-${viewId}`);
                if (target) target.classList.add('active');

                document.querySelectorAll('.nav-links li').forEach(el => el.classList.remove('active'));
                const navItem = Array.from(document.querySelectorAll('.nav-links li')).find(el => {
                    const txt = el.textContent.toLowerCase();
                    return txt.includes(viewId.replace('home', 'painel')) || (viewId === 'home' && txt.includes('painel'));
                });
                if (navItem) navItem.classList.add('active');

                if (viewId !== 'scanner') this.stopScanner();
                document.getElementById('sidebar').classList.remove('mobile-open');
            }

            syncSites() {
                google.script.run
                    .withSuccessHandler((r) => {
                        window.ALL_SITES = JSON.parse(r);
                        this.populateSitesDropdown();
                    })
                    .getSitesData();
            }

            populateSitesDropdown() {
                const select = document.getElementById('new-mach-site');
                if (!select) return;
                select.innerHTML = '<option value="">Selecione um local...</option>';
                if (window.ALL_SITES) {
                    Object.values(window.ALL_SITES).forEach(site => {
                        select.innerHTML += `<option value="${site.id}">${site.id} - ${site.name}</option>`;
                    });
                }
            }

            saveNewSite() {
                const newSite = {
                    id: document.getElementById('new-site-id').value.toUpperCase(),
                    name: document.getElementById('new-site-name').value,
                    address: document.getElementById('new-site-address').value,
                    responsible: document.getElementById('new-site-resp').value,
                    type: document.getElementById('new-site-type').value,
                    occupancy: document.getElementById('new-site-occupancy').value
                };
                this.setLoader(true);
                google.script.run
                    .withSuccessHandler((response) => {
                        this.setLoader(false);
                        this.showToast(response.message, response.success ? "success" : "error");
                        if (response.success) {
                            document.getElementById('addSiteForm').reset();
                            this.syncSites();
                            this.navigate('home');
                        }
                    })
                    .saveNewSiteToSheet(newSite, this.currentUser.role);
            }

            syncMachines() {
                google.script.run
                    .withSuccessHandler((r) => { window.ALL_MACHINES = JSON.parse(r); })
                    .getMachinesData();
            }

            saveNewMachine() {
                const newMachine = {
                    id: document.getElementById('new-mach-id').value.toUpperCase(),
                    serial: document.getElementById('new-mach-serial').value,
                    location: document.getElementById('new-mach-loc').value,
                    type: document.getElementById('new-mach-type').value,
                    btus: document.getElementById('new-mach-btu').value,
                    brand: document.getElementById('new-mach-brand').value,
                    siteId: document.getElementById('new-mach-site').value
                };
                this.setLoader(true);
                google.script.run
                    .withSuccessHandler((response) => {
                        this.setLoader(false);
                        this.showToast(response.message, response.success ? "success" : "error");
                        if (response.success) {
                            document.getElementById('addMachineForm').reset();
                            this.syncMachines();
                            this.loadMachineFrontend(newMachine);
                        }
                    })
                    .saveNewMachineToSheet(newMachine, this.currentUser.role);
            }

            searchMachine() {
                const query = document.getElementById('search-input').value.trim().toUpperCase();
                if (window.ALL_MACHINES && window.ALL_MACHINES[query]) {
                    this.loadMachineFrontend(window.ALL_MACHINES[query]);
                } else {
                    this.showToast(`TAG ${query} não encontrada`, "error");
                }
            }

            loadMachineFrontend(machine) {
                this.currentMachine = machine;
                document.getElementById('machine-title').textContent = `Equipamento ${machine.id}`;
                document.getElementById('form-machine-id').textContent = `TAG: ${machine.id}`;

                let siteName = "Desconhecido";
                if (machine.siteId && window.ALL_SITES && window.ALL_SITES[machine.siteId]) {
                    siteName = window.ALL_SITES[machine.siteId].name;
                }

                document.getElementById('machine-details-list').innerHTML = `
                    <li><span class="text-muted">Unidade / Site:</span> <strong>${siteName}</strong></li>
                    <li><span class="text-muted">TAG/ID:</span> <strong>${machine.id}</strong></li>
                    <li><span class="text-muted">S/N Fábrica:</span> <strong>${machine.serial || 'N/A'}</strong></li>
                    <li><span class="text-muted">Setor/Sala:</span> <strong>${machine.location}</strong></li>
                    <li><span class="text-muted">Sistema:</span> <strong>${machine.type}</strong></li>
                    <li><span class="text-muted">Potência:</span> <strong>${machine.btus} BTUs</strong></li>
                    <li><span class="text-muted">Fabricante:</span> <strong>${machine.brand}</strong></li>
                `;
                this.navigate('machine');
                this.loadHistoryFromSheets(machine.id);
            }

            loadHistoryFromSheets(machineId) {
                this.setLoader(true);
                google.script.run
                    .withSuccessHandler((json) => {
                        this.setLoader(false);
                        const history = JSON.parse(json);
                        const tbody = document.getElementById('machine-history-body');
                        if (history.length === 0) {
                            tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;">Sem registros.</td></tr>';
                            return;
                        }
                        tbody.innerHTML = history.map(r => {
                            let d = r.date;
                            if (d.includes('T')) d = new Date(d).toLocaleDateString('pt-BR');
                            return `<tr><td>${d}</td><td>${r.technician}</td><td><span class="badge">Atendido</span></td><td><button class="btn-outline" style="padding:4px 8px; font-size:12px;">Ver O.S.</button></td></tr>`;
                        }).join('');
                    })
                    .getHistoryData(machineId);
            }

            showNewPmocForm() {
                document.getElementById('pmocForm').reset();
                document.getElementById('pmoc-date').valueAsDate = new Date();
                document.getElementById('pmoc-tecnico').value = this.currentUser.name;
                this.navigate('pmoc-form');
            }

            savePmocData() {
                const record = {
                    id: 'PMOC-' + Date.now().toString().slice(-6),
                    machineId: this.currentMachine.id,
                    date: document.getElementById('pmoc-date').value,
                    technician: this.currentUser.name,
                    crea: document.getElementById('pmoc-crea').value || 'Não informado',
                    art: document.getElementById('pmoc-art').value || 'N/A',
                    obs: document.getElementById('pmoc-obs').value,
                    ar_status: document.getElementById('pmoc-ar-status').value,
                    checks: {
                        limpeza: document.getElementById('chk-limpeza').checked,
                        serpentina: document.getElementById('chk-serpentina').checked,
                        pressao: document.getElementById('chk-pressao').checked,
                        eletrica: document.getElementById('chk-eletrica').checked,
                    }
                };
                this.setLoader(true);
                google.script.run
                    .withSuccessHandler((response) => {
                        this.setLoader(false);
                        if (response.success) {
                            this.showToast("PMOC Salvo com Sucesso!", "success");
                            this.printA4AndReturn(record);
                        } else {
                            this.showToast(response.message, "error");
                        }
                    })
                    .savePmocRecordToSheet(record);
            }

            startScanner() {
                if (this.html5QrcodeScanner) return;
                this.html5QrcodeScanner = new Html5Qrcode("reader");
                this.html5QrcodeScanner.start(
                    { facingMode: "environment" }, { fps: 10, qrbox: 250 },
                    (text) => {
                        this.stopScanner();
                        document.getElementById('search-input').value = text;
                        this.searchMachine();
                    },
                    () => { }
                ).catch(() => this.showToast("Câmera indisponível", "error"));
            }

            stopScanner() {
                if (this.html5QrcodeScanner) {
                    this.html5QrcodeScanner.stop().then(() => {
                        this.html5QrcodeScanner.clear();
                        this.html5QrcodeScanner = null;
                    }).catch(() => { });
                }
            }

            generateMachineQR() {
                if (!this.currentMachine) return;
                const qrUrl = `https://quickchart.io/qr?text=${encodeURIComponent(this.currentMachine.id)}&size=300&margin=2`;

                const win = window.open('', '_blank');
                win.document.write(`
                    <html><head><title>Etiqueta PMOC - ${this.currentMachine.id}</title></head>
                    <body style="font-family:sans-serif; display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh;">
                        <div style="border:3px solid #BE1E2D; padding:30px; border-radius:15px; text-align:center;">
                            <h1 style="color:#BE1E2D; margin:0;">DATAMETRICA</h1>
                            <p style="margin:5px 0 20px;">Gestão de Climatização Inteligente</p>
                            <img src="${qrUrl}" style="width:250px;">
                            <h2 style="margin:20px 0 5px;">TAG: ${this.currentMachine.id}</h2>
                            <p style="color:#666;">Scaneie para consultar histórico</p>
                        </div>
                        <button onclick="window.print()" style="margin-top:30px; padding:10px 20px; background:#BE1E2D; color:#fff; border:none; border-radius:5px; cursor:pointer;">IMPRIMIR ETIQUETA</button>
                    </body></html>
                `);
                win.document.close();
            }

            printA4AndReturn(record) {
                const m = this.currentMachine;
                const pa = document.getElementById('printable-area');
                let site = { name: "N/I", address: "N/I", responsible: "N/I", type: "N/I", occupancy: "N/I" };

                if (m.siteId && window.ALL_SITES && window.ALL_SITES[m.siteId]) {
                    site = window.ALL_SITES[m.siteId];
                }

                pa.innerHTML = `
                    <div class="pmoc-print-header">
                        <div>
                            <h1>PMOC - PLANO DE MANUTENÇÃO, OPERAÇÃO E CONTROLE</h1>
                            <p>Relatório de Execução Técnica | O.S. Nº: <strong>${record.id}</strong></p>
                            <p style="font-size:10pt;">Em conformidade com a Lei Federal nº 13.589/2018</p>
                        </div>
                        <svg viewBox="0 0 100 100" style="width:60px; height:60px;">
                            <path d="M 0 20 Q 0 0 20 0 L 100 0 L 100 80 Q 100 100 80 100 L 0 100 Z" fill="#b0b0b0"/>
                            <rect x="50" y="0" width="50" height="50" fill="#BE1E2D"/>
                            <rect x="25" y="50" width="25" height="25" fill="#58595b"/>
                            <rect x="0" y="75" width="25" height="25" fill="#58595b"/>
                        </svg>
                    </div>

                    <div style="border:1px solid black; padding:10px; margin-bottom:15px;">
                        <h3 style="background:#eee; padding:5px; margin-top:0;">1. DADOS DA EDIFICAÇÃO / CLIENTE</h3>
                        <p><strong>Razão Social:</strong> ${site.name}</p>
                        <p><strong>Endereço:</strong> ${site.address}</p>
                        <p><strong>Responsável Local:</strong> ${site.responsible} | <strong>Tipo de Uso:</strong> ${site.type || 'Público/Coletivo'}</p>
                        <p><strong>Ocupação Média:</strong> ${site.occupancy || 'Não informado'} pessoas</p>
                    </div>

                    <div style="border:1px solid black; padding:10px; margin-bottom:15px;">
                        <h3 style="background:#eee; padding:5px; margin-top:0;">2. IDENTIFICAÇÃO DO SISTEMA</h3>
                        <div style="display:grid; grid-template-columns:1fr 1fr;">
                            <p><strong>TAG/ID:</strong> ${m.id}</p>
                            <p><strong>Nº Série:</strong> ${m.serial || 'N/I'}</p>
                            <p><strong>Capacidade:</strong> ${m.btus} BTUs</p>
                            <p><strong>Localização:</strong> ${m.location}</p>
                            <p><strong>Marca/Fabricante:</strong> ${m.brand}</p>
                            <p><strong>Tipo Sistema:</strong> ${m.type}</p>
                        </div>
                    </div>

                    <div style="border:1px solid black; padding:10px; margin-bottom:15px;">
                        <h3 style="background:#eee; padding:5px; margin-top:0;">3. EXECUÇÃO E RESPONSÁVEL TÉCNICO</h3>
                        <p><strong>Data Manutenção:</strong> ${record.date.split('-').reverse().join('/')}</p>
                        <p><strong>Técnico Responsável:</strong> ${record.technician}</p>
                        <p><strong>Registro (CREA/CFT):</strong> ${record.crea} | <strong>ART/TRT:</strong> ${record.art}</p>
                    </div>

                    <div style="border:1px solid black; padding:10px; margin-bottom:15px;">
                        <h3 style="background:#eee; padding:5px; margin-top:0;">4. PROCEDIMENTOS E QUALIDADE DO AR (RDC 09)</h3>
                        <p><strong>Itens Verificados:</strong> 
                            ${record.checks.limpeza ? '[X] Limpeza Filtros ' : ''}
                            ${record.checks.serpentina ? '[X] Serpentina ' : ''}
                            ${record.checks.pressao ? '[X] Pressão/Carga Gás ' : ''}
                            ${record.checks.eletrica ? '[X] Sist. Elétrico ' : ''}
                        </p>
                        <p><strong>Avaliação Qualidade do Ar:</strong> ${record.ar_status}</p>
                        <p><strong>Observações:</strong> ${record.obs || 'Equipamento operando conforme normas vigentes.'}</p>
                    </div>

                    <div style="margin-top:60px; display:flex; justify-content:space-around; text-align:center; font-size:10pt;">
                        <div><div style="border-top:1px solid black; width:220px; margin-bottom:5px;"></div>Assinatura do Cliente / Responsável</div>
                        <div><div style="border-top:1px solid black; width:220px; margin-bottom:5px;"></div>${record.technician.toUpperCase()}<br>Responsável Técnico</div>
                    </div>

                    <div style="margin-top:30px; font-size:8pt; border-top:1px dashed #ccc; padding-top:10px;">
                        <strong>Referências Legais:</strong> Lei 13.589/2018, Portaria 3.523/MS, Resolução RDC nº 09/ANVISA.
                    </div>
                `;
                window.print();
                this.loadMachineFrontend(m);
            }
        }

        var app;
        window.addEventListener('load', function () {
            app = new PMOCPremium();
            window.app = app;
            const btn = document.getElementById('login-btn');
            if (btn) btn.addEventListener('click', () => app.attemptLogin());
            console.log("PMOC DTM: Premium System Ready.");
        });
    </script>
</body>

</html>

</body>

</html>
